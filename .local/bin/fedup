#!/bin/bash

IMAGE=fedora
CONTAINER=fedora

colima status
if [ $? -ne 0 ]; then
  colima start --arch aarch64 --vm-type=vz --vz-rosetta --cpu 4 --memory 8 --disk 40
fi

docker ps --format '{{.Names}}' | grep ${CONTAINER}
if [ $? -ne 0 ]; then
  docker ps -a --format '{{.Repository}}' | grep ${CONTAINER}
  if [ $? -ne 0 ]; then
    docker create -d --name ${CONTAINER} -v ${HOME}:/root ${IMAGE} sleep infinity
  fi
  docker start ${CONTAINER}
fi

if [ $# -eq 0 ]; then
  docker exec -ti ${CONTAINER} zsh
elif [ "${1}" =  "down" ]; then
  docker stop ${CONTAINER}
elif [ "${1}" =  "halt" ]; then
  docker stop ${CONTAINER}
  colima stop
else
  docker exec -ti ${CONTAINER} $@
fi
